<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>H₂ storage · EnergyModelsHydrogen</title><meta name="title" content="H₂ storage · EnergyModelsHydrogen"/><meta property="og:title" content="H₂ storage · EnergyModelsHydrogen"/><meta property="twitter:title" content="H₂ storage · EnergyModelsHydrogen"/><meta name="description" content="Documentation for EnergyModelsHydrogen."/><meta property="og:description" content="Documentation for EnergyModelsHydrogen."/><meta property="twitter:description" content="Documentation for EnergyModelsHydrogen."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">EnergyModelsHydrogen</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Manual</span><ul><li><a class="tocitem" href="../../manual/quick-start/">Quick Start</a></li><li><a class="tocitem" href="../../manual/simple-example/">Examples</a></li><li><a class="tocitem" href="../../manual/NEWS/">Release notes</a></li></ul></li><li><span class="tocitem">Nodes</span><ul><li><a class="tocitem" href="../electrolyzer/">Electrolyzer</a></li><li><a class="tocitem" href="../reformer/">Reformer</a></li><li class="is-active"><a class="tocitem" href>H₂ storage</a><ul class="internal"><li><a class="tocitem" href="#nodes-h2_storage-fields"><span>Introduced types and their fields</span></a></li><li><a class="tocitem" href="#nodes-h2_storage-math"><span>Mathematical description</span></a></li></ul></li></ul></li><li><span class="tocitem">How to</span><ul><li><a class="tocitem" href="../../how-to/contribute/">Contribute to EnergyModelsHydrogen</a></li></ul></li><li><span class="tocitem">Auxiliary functions</span><ul><li><a class="tocitem" href="../../aux-fun/lin-reform/">Linear reformulation</a></li><li><a class="tocitem" href="../../aux-fun/pressure_calc/">Compression energy</a></li></ul></li><li><span class="tocitem">Library</span><ul><li><a class="tocitem" href="../../library/public/">Public</a></li><li><input class="collapse-toggle" id="menuitem-6-2" type="checkbox"/><label class="tocitem" for="menuitem-6-2"><span class="docs-label">Internals</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../library/internals/types-EMH/">Types</a></li><li><a class="tocitem" href="../../library/internals/methods-fields/">Methods - Accessing fields</a></li><li><a class="tocitem" href="../../library/internals/methods-EMH/">Methods - Internal</a></li><li><a class="tocitem" href="../../library/internals/methods-EMB/">Methods - <code>EnergyModelsBase</code></a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Nodes</a></li><li class="is-active"><a href>H₂ storage</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>H₂ storage</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/EnergyModelsX/EnergyModelsHydrogen.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/EnergyModelsX/EnergyModelsHydrogen.jl/blob/main/docs/src/nodes/h2_storage.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="nodes-h2_storage"><a class="docs-heading-anchor" href="#nodes-h2_storage">Hydrogen storage nodes</a><a id="nodes-h2_storage-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-h2_storage" title="Permalink"></a></h1><p>Hydrogen storage nodes are in some aspects differing from standard <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.Storage"><code>Storage</code></a> nodes. A first difference is that the maximum installed charge capacity is dependent on the maximum installed storage level capacity. The reason for this dependency is that the stability of the storage allows only for small storage level changes. In the case of gas storage, fast pressure changes would have a significant impact on the stability of the storage vessel (or alternatively the cavern, when stored in salt caverns). A second difference is that the maximum discharge rate is normally stated as a multiple of the charge rate. This can be explained as well by the stability of the storage in which large pressure changes should be avoided.</p><p>As a consequence, new nodal descriptions are incorporated in <code>EnergyModelsHydrogen</code> specifically for modelling hydrogen storage.</p><h2 id="nodes-h2_storage-fields"><a class="docs-heading-anchor" href="#nodes-h2_storage-fields">Introduced types and their fields</a><a id="nodes-h2_storage-fields-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-h2_storage-fields" title="Permalink"></a></h2><p><code>EnergyModelsHydrogen</code> introduces two hydrogen storage nodes, <a href="../../library/public/#EnergyModelsHydrogen.SimpleHydrogenStorage"><code>SimpleHydrogenStorage</code></a> and <a href="../../library/public/#EnergyModelsHydrogen.HydrogenStorage"><code>HydrogenStorage</code></a>.</p><p><a href="../../library/public/#EnergyModelsHydrogen.SimpleHydrogenStorage"><code>SimpleHydrogenStorage</code></a> nodes incorporate the constraints on the maximum discharge from the storage as well as the constraint on the maximum charge rate to storage capacity. The latter is used in the internal checks, if a standard operational model is utilized, while it restricts investments in capacity expansions models.</p><p><a href="../../library/public/#EnergyModelsHydrogen.HydrogenStorage"><code>HydrogenStorage</code></a> nodes include all constraints from <a href="../../library/public/#EnergyModelsHydrogen.SimpleHydrogenStorage"><code>SimpleHydrogenStorage</code></a> nodes. In addition, the nodes include a storage level dependent term for the electricity requirement. This is implemented as a combination of a bilinear term and a piecewise linear interpolation using <em><a href="https://jump.dev/JuMP.jl/stable/manual/constraints/#Special-Ordered-Sets-of-Type-2">Special Ordered Sets of Type 2 constraints</a></em>.</p><div class="admonition is-warning"><header class="admonition-header">`HydrogenStorage` nodes and investment models</header><div class="admonition-body"><p>The current implementation of <a href="../../library/public/#EnergyModelsHydrogen.HydrogenStorage"><code>HydrogenStorage</code></a> nodes does not allow their usage in capacity expansion models. The optimization problem would in this case include a bilinear term on the flow into the storage node, the current capacity, and the current storage level. This leads to a complex optimization model. As a consequence, we decided to only allow <a href="../../library/public/#EnergyModelsHydrogen.HydrogenStorage"><code>HydrogenStorage</code></a> nodes in operational models.</p><p>This is checked through the function <code>EMB.check_node_data</code> in the <code>EnergyModelsInvestments</code> extension.</p></div></div><h3 id="nodes-h2_storage-fields-stand"><a class="docs-heading-anchor" href="#nodes-h2_storage-fields-stand">Standard fields</a><a id="nodes-h2_storage-fields-stand-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-h2_storage-fields-stand" title="Permalink"></a></h3><p>The fields of both storage nodes are given as:</p><ul><li><p><strong><code>id</code></strong>:<br/>The field <code>id</code> is only used for providing a name to the node.</p></li><li><p><strong><code>charge::UnionCapacity</code></strong>:<br/>The charge storage parameters must include a capacity. More information can be found on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_par">storage parameters</a></em>.</p></li><li><p><strong><code>level::UnionCapacity</code></strong>:<br/>The level storage parameters must include a capacity. More information can be found on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_par">storage parameters</a></em>.</p><div class="admonition is-info"><header class="admonition-header">Permitted values for storage parameters in `charge` and `level`</header><div class="admonition-body"><p>If the node should contain investments through the application of <a href="https://energymodelsx.github.io/EnergyModelsInvestments.jl/"><code>EnergyModelsInvestments</code></a>, it is important to note that you can only use <code>FixedProfile</code> or <code>StrategicProfile</code> for the capacity, but not <code>RepresentativeProfile</code> or <code>OperationalProfile</code>. Similarly, you can only use <code>FixedProfile</code> or <code>StrategicProfile</code> for the fixed OPEX, but not <code>RepresentativeProfile</code> or <code>OperationalProfile</code>. The variable operating expenses can be provided as <code>OperationalProfile</code> as well. In addition, all capacity and fixed OPEX values have to be non-negative.</p></div></div></li><li><p><strong><code>stor_res::ResourceCarrier</code></strong>:<br/>The <code>stor_res</code> is the stored <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/resources/#EnergyModelsBase.Resource"><code>Resource</code></a>.</p></li><li><p><strong><code>input::Dict{&lt;:Resource,&lt;:Real}</code></strong> and <strong><code>output::Dict{&lt;:Resource,&lt;:Real}</code></strong>:<br/>Both fields describe the <code>input</code> and <code>output</code> <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/resources/#EnergyModelsBase.Resource"><code>Resource</code></a>s with their corresponding conversion factors as dictionaries. All values have to be non-negative.</p><div class="admonition is-info"><header class="admonition-header">Meaning in both nodes</header><div class="admonition-body"><p>In the case of a <a href="../../library/public/#EnergyModelsHydrogen.SimpleHydrogenStorage"><code>SimpleHydrogenStorage</code></a>, the input should correspond to the hydogen and electricity resources. The chosen value in the dictionary for the hydrogen resource is not relevant. However, the chosen value for the electricity resource impacts the required compression energy.</p><p><a href="../../library/public/#EnergyModelsHydrogen.HydrogenStorage"><code>HydrogenStorage</code></a> do not have the fields input and output. The individual resources used as input and output are instead obtained through dispatching on the functions <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.inputs-Tuple%7BEnergyModelsBase.Node%7D"><code>inputs</code></a> and <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.outputs-Tuple%7BEnergyModelsBase.Node%7D"><code>outputs</code></a>. The inputs correspond in this case to the field <code>stor_res</code> and <code>el_res</code>. The latter is explained the following section.</p></div></div></li><li><p><strong><code>data::Vector{Data}</code></strong>:<br/>An entry for providing additional data to the model. In the current version, it is used for providing additional investment data when <a href="https://energymodelsx.github.io/EnergyModelsInvestments.jl/"><code>EnergyModelsInvestments</code></a> is used.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The field <code>data</code> is not required as we include a constructor when the value is excluded. The current implementation of <a href="../../library/public/#EnergyModelsHydrogen.HydrogenStorage"><code>HydrogenStorage</code></a> does not allow for investment data.</p></div></div></li></ul><h3 id="nodes-h2_storage-fields-new"><a class="docs-heading-anchor" href="#nodes-h2_storage-fields-new">Additional fields</a><a id="nodes-h2_storage-fields-new-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-h2_storage-fields-new" title="Permalink"></a></h3><p><a href="../../library/internals/types-EMH/#EnergyModelsHydrogen.AbstractH2Storage"><code>AbstractH2Storage</code></a> nodes add additional fields compared to <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.RefStorage"><code>RefStorage</code></a> nodes. The location of the fields is changing. Hence, it is beneficial to use the docstrings (<a href="../../library/public/#EnergyModelsHydrogen.SimpleHydrogenStorage"><code>SimpleHydrogenStorage</code></a> and <a href="../../library/public/#EnergyModelsHydrogen.HydrogenStorage"><code>HydrogenStorage</code></a>) in which the order is included.</p><p>The individual fields are related to specifics of storing gases. Boths nodes have the following fields:</p><ul><li><strong><code>discharge_charge::Float64</code></strong>:<br/>The discharge to charge ratio specifies the maximum allowed discharge as a ratio of the installed charging capacity. It is important due to the stability of the storage vessel or cavern. As a consequence of its introduction, it is not possible to specify a <code>discharge</code> capacity to the storage node.</li><li><strong><code>level_charge::Float64</code></strong>:<br/>The level to charge ratio specifies the maximum allowed storage level capacity as a ratio of the charging capacity. The implementation is rquired to avoid large pressure changes in the vessel in a short period.</li></ul><div class="admonition is-info"><header class="admonition-header">Allowed values</header><div class="admonition-body"><p>Both ratios have to be positive. The field <code>level_charge</code> is in operational models only used for checking the provided input capacities while it is used in investment models to restrict the investments in the charge capacity.</p></div></div><p><a href="../../library/public/#EnergyModelsHydrogen.HydrogenStorage"><code>HydrogenStorage</code></a> have in addition several fields:</p><ul><li><strong><code>el_res::ResourceEmit</code></strong>:<br/>The <code>el_res</code> is the <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/resources/#EnergyModelsBase.Resource"><code>Resource</code></a> that corresponds in the chosen system to electricity. It is required to specify it to avoid</li><li><strong><code>p_min::Float64</code></strong>:<br/>The minimum pressure in the vessel is required for stability purposes. The implementation of the minimum pressure requires a <em>cushion gas</em> which always remains in the storage vessel. The cushion gas is <strong>not</strong> included in the analysis. It must be instead included in the storage level capital expenditures as it is linear proportional to the storage level capacity.<br/>The value is</li><li><strong><code>p_charge::Float64</code></strong>:<br/>The charge pressure is the pressure used to calculate the required electricity for compressing the gas to the storage pressure. It corresponds to the pressure at the boundaries of the storage node.</li><li><strong><code>p_max::Float64</code></strong>:<br/>The maximum pressure in the vessel is also required for stability purposes. Depending on the storage type, this pressure is either defined through the wall properties (when considering small on-site storage) or through the depth (when considering storage in salt caverns).</li></ul><div class="admonition is-info"><header class="admonition-header">Allowed values and units</header><div class="admonition-body"><p>All pressures have to be positive. The maximum pressure <code>p_max</code> has to be larger than the minimum pressure <code>p_min</code>. The charging pressure <code>p_charge</code> can be any positive value. If it is larger than <code>p_max</code>, it is however beneficial to use a <a href="../../library/public/#EnergyModelsHydrogen.SimpleHydrogenStorage"><code>SimpleHydrogenStorage</code></a> instead without an electricity input as no compression is required.</p></div></div><h2 id="nodes-h2_storage-math"><a class="docs-heading-anchor" href="#nodes-h2_storage-math">Mathematical description</a><a id="nodes-h2_storage-math-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-h2_storage-math" title="Permalink"></a></h2><p>In the following mathematical equations, we use the name for variables and functions used in the model. Variables are in general represented as</p><p><span>$\texttt{var\_example}[index_1, index_2]$</span></p><p>with square brackets, while functions are represented as</p><p><span>$func\_example(index_1, index_2)$</span></p><p>with paranthesis.</p><h3 id="nodes-h2_storage-math-var"><a class="docs-heading-anchor" href="#nodes-h2_storage-math-var">Variables</a><a id="nodes-h2_storage-math-var-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-h2_storage-math-var" title="Permalink"></a></h3><p>The variables of both <a href="../../library/public/#EnergyModelsHydrogen.SimpleHydrogenStorage"><code>SimpleHydrogenStorage</code></a> and <a href="../../library/public/#EnergyModelsHydrogen.HydrogenStorage"><code>HydrogenStorage</code></a> nodes include:</p><ul><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-opex"><span>$\texttt{opex\_var}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-opex"><span>$\texttt{opex\_fixed}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_level}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_level\_inst}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_charge\_use}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_charge\_inst}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_discharge\_use}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-flow"><span>$\texttt{flow\_in}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-flow"><span>$\texttt{flow\_out}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_level\_Δ\_op}$</span></a></li><li><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap"><span>$\texttt{stor\_level\_Δ\_rp}$</span></a> if the <code>TimeStruct</code> includes <code>RepresentativePeriods</code></li></ul><h3 id="nodes-h2_storage-math-con"><a class="docs-heading-anchor" href="#nodes-h2_storage-math-con">Constraints</a><a id="nodes-h2_storage-math-con-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-h2_storage-math-con" title="Permalink"></a></h3><p>The following sections omit the direct inclusion of the vector of hydrogen storage nodes. Instead, it is implicitly assumed that the constraints are valid <span>$\forall n ∈ N$</span> for all <a href="../../library/public/#EnergyModelsHydrogen.SimpleHydrogenStorage"><code>SimpleHydrogenStorage</code></a> or <a href="../../library/public/#EnergyModelsHydrogen.HydrogenStorage"><code>HydrogenStorage</code></a> types if not stated differently. In addition, all constraints are valid <span>$\forall t \in T$</span> (that is in all operational periods) or <span>$\forall t_{inv} \in T^{Inv}$</span> (that is in all investment periods).</p><h4 id="nodes-h2_storage-math-con-stand"><a class="docs-heading-anchor" href="#nodes-h2_storage-math-con-stand">Standard constraints</a><a id="nodes-h2_storage-math-con-stand-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-h2_storage-math-con-stand" title="Permalink"></a></h4><p>Hydrogen storages nodes utilize in general the standard constraints described on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/constraint-functions/#man-con">Constraint functions</a></em> for <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.RefStorage"><code>RefStorage</code></a> nodes.</p><p>These standard constraints are:</p><ul><li><p><code>constraints_capacity_installed</code>:</p><p class="math-container">\[\begin{aligned}
\texttt{stor\_level\_inst}[n, t] &amp; = capacity(level(n), t) \\
\texttt{stor\_charge\_inst}[n, t] &amp; = capacity(charge(n), t)
\end{aligned}\]</p></li><li><p><code>constraints_flow_in</code>:<br/>The flow into a hydrogen storage node is given by:</p><p class="math-container">\[\texttt{flow\_in}[n, t, stor\_res(n)] = \texttt{stor\_charge\_use}[n, t]\]</p><p>The flow of the electricity resource is dependent on the chosen type, and hence, explained below in detail.</p></li><li><p><code>constraints_flow_out</code>:</p><p class="math-container">\[\texttt{flow\_out}[n, t, stor\_res(n)] = \texttt{stor\_discharge\_use}[n, t]\]</p></li><li><p><code>constraints_level</code>:<br/>The level constraints are more complex compared to the standard constraints. They are explained in detail below in <em><a href="#nodes-h2_storage-math-con-level">Level constraints</a></em>.</p></li><li><p><code>constraints_opex_fixed</code>:</p><p class="math-container">\[\begin{aligned}
\texttt{opex\_fixed}&amp;[n, t_{inv}] = \\ &amp;
  opex\_fixed(level(n), t_{inv}) \times \texttt{stor\_level\_inst}[n, first(t_{inv})] + \\ &amp;
  opex\_fixed(charge(n), t_{inv}) \times \texttt{stor\_charge\_inst}[n, first(t_{inv})]
\end{aligned}\]</p><div class="admonition is-success"><header class="admonition-header">Why do we use `first()`</header><div class="admonition-body"><p>The variables <span>$\texttt{stor\_level\_inst}$</span> are declared over all operational periods (see the section on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/optimization-variables/#man-opt_var-cap">Capacity variables</a></em> for further explanations). Hence, we use the function <span>$first(t_{inv})$</span> to retrieve the installed capacities in the first operational period of a given investment period <span>$t_{inv}$</span> in the function <code>constraints_opex_fixed</code>.</p></div></div></li><li><p><code>constraints_opex_var</code>:</p><p class="math-container">\[\begin{aligned}
\texttt{opex\_var}&amp;[n, t_{inv}] = \\ \sum_{t \in t_{inv}}&amp;
  opex\_var(level(n), t) \times \texttt{stor\_level}[n, t] \times scale\_op\_sp(t_{inv}, t) + \\ &amp;
  opex\_var(charge(n), t) \times \texttt{stor\_charge\_use}[n, t] \times scale\_op\_sp(t_{inv}, t)
\end{aligned}\]</p><div class="admonition is-success"><header class="admonition-header">The function `scale_op_sp`</header><div class="admonition-body"><p>The function <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/functions/#EnergyModelsBase.scale_op_sp"><span>$scale\_op\_sp(t_{inv}, t)$</span></a> calculates the scaling factor between operational and investment periods. It also takes into account potential operational scenarios and their probability as well as representative periods.</p></div></div></li><li><p><code>constraints_data</code>:<br/>This function is only called for specified data of the storage node, see above.</p></li></ul><div class="admonition is-info"><header class="admonition-header">Implementation of capacity and OPEX</header><div class="admonition-body"><p>Even if an <code>AbstractHStorage</code> node includes the corresponding capacity field (<em>i.e.</em>, <code>charge</code>, <code>level</code>), we only include the fixed and variable OPEX constribution for the different capacities if the corresponding <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_par">storage parameters</a></em> have a field <code>opex_fixed</code> and <code>opex_var</code>, respectively. Otherwise, they are omitted.</p></div></div><p>Both hydrogen storage nodes provide a new method for the function <code>EMB.constraints_capacity</code>. While the standard constraints remain unchanged,</p><p class="math-container">\[\begin{aligned}
\texttt{stor\_level\_use}[n, t] &amp; = \texttt{stor\_level\_inst}[n, t] \\
\texttt{stor\_charge\_use}[n, t] &amp; = \texttt{stor\_charge\_inst}[n, t]
\end{aligned}\]</p><p>additional constraints are introduced to account for the introduced limits through the fields <code>discharge_charge</code> and <code>level_charge</code>:</p><p class="math-container">\[\begin{aligned}
\texttt{stor\__discharge\_use}[n, t] &amp; \leq discharge\_charge(n) \texttt{stor\_charge\_use}[n, t] \\
\texttt{stor\_charge\_inst}[n, t] level\_charge(n) &amp; \leq \texttt{stor\_level\_inst}[n, t]
\end{aligned}\]</p><p>The second constraint also limitsthe potential for investments in the charge capacity through the different constraints introduced in <code>EnergyModelsBase</code>.</p><p>The function <code>constraints_flow_in</code> is different for <a href="../../library/public/#EnergyModelsHydrogen.SimpleHydrogenStorage"><code>SimpleHydrogenStorage</code></a> and <a href="../../library/public/#EnergyModelsHydrogen.HydrogenStorage"><code>HydrogenStorage</code></a>. <a href="../../library/public/#EnergyModelsHydrogen.SimpleHydrogenStorage"><code>SimpleHydrogenStorage</code></a> nodes utilize the standard method. The auxiliary resource constraints are in this case given by:</p><p class="math-container">\[\texttt{flow\_in}[n, t, p] = inputs(n, p) \times \texttt{flow\_in}[n, stor\_res(n)]
\qquad \forall p \in inputs(n) \setminus \{stor\_res(n)\}\]</p><p><a href="../../library/public/#EnergyModelsHydrogen.HydrogenStorage"><code>HydrogenStorage</code></a> nodes include a pressure dependent term for the required compression energy. As a consequence, the required electricity for compression is depending on both the hydrogen flow into the storage node and the storage level. The constraint is given by</p><p class="math-container">\[\texttt{flow\_in}[n, t, electricity\_resource(n)]  = \texttt{flow\_in}[n, stor\_res(n)] \times W\_p[t]\]</p><p>in which <span>$W_p[t]$</span> is dependent on the storage level. The calculation of <span>$W_p[t]$</span> is explained in the section <em><a href="#nodes-h2_storage-math-con-comp">Compression constraints</a></em></p><h4 id="nodes-h2_storage-math-con-level"><a class="docs-heading-anchor" href="#nodes-h2_storage-math-con-level">Level constraints</a><a id="nodes-h2_storage-math-con-level-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-h2_storage-math-con-level" title="Permalink"></a></h4><p>The level constraints are in general slightly more complex to understand. The overall structure is outlined on <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/manual/constraint-functions/#man-con-stor_level">Constraint functions</a></em>. The level constraints are called through the function <code>constraints_level</code> which then calls additional functions depending on the chosen time structure (whether it includes representative periods and/or operational scenarios) and the chosen <em><a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#lib-pub-nodes-stor_behav">storage behaviour</a></em>.</p><p>The hydrogen storage nodes utilize all concepts from <code>EnergyModelsBase</code>. They remain unchanged, but are repeated below for a concise understanding. If the time structure includes representative periods, we also calculate the change of the storage level in each representative period within the function <code>constraints_level_iterate</code> (from <code>EnergyModelsBase</code>):</p><p class="math-container">\[  \texttt{stor\_level\_Δ\_rp}[n, t_{rp}] = \sum_{t \in t_{rp}}
  \texttt{stor\_level\_Δ\_op}[n, t] \times scale\_op\_sp(t_{inv}, t)\]</p><p>The general level constraint is calculated in the function <code>constraints_level_iterate</code> (from <code>EnergyModelsBase</code>):</p><p class="math-container">\[\texttt{stor\_level}[n, t] = prev\_level +
\texttt{stor\_level\_Δ\_op}[n, t] \times duration(t)\]</p><p>in which the value <span>$prev\_level$</span> is depending on the type of the previous operational (<span>$t_{prev}$</span>) and strategic level (<span>$t_{inv,prev}$</span>) (as well as the previous representative period (<span>$t_{rp,prev}$</span>)). It is calculated through the function <code>previous_level</code>.</p><p>In the case of hydropower node, we can distinguish the following cases:</p><ol><li><p>The first operational period in the first representative period in any investment period (given by <span>$typeof(t_{prev}) = typeof(t_{rp, prev})$</span> and <span>$typeof(t_{inv,prev}) = NothingPeriod$</span>). In this situation, we can distinguish three cases, the time structure does not include representative periods:</p><p class="math-container">\[prev\_level = \texttt{stor\_level}[n, last(t_{inv})]\]</p><p>the time structure includes representative periods and the storage behavior is given as <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.CyclicRepresentative"><code>CyclicRepresentative</code></a>:</p><p class="math-container">\[prev\_level = \texttt{stor\_level}[n, last(t_{rp})]\]</p><p>the time structure includes representative periods and the storage behavior is given as <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.CyclicStrategic"><code>CyclicStrategic</code></a>:</p><p class="math-container">\[\begin{aligned}
 prev\_level = &amp; \texttt{stor\_level}[n, first(t_{rp,last})] - \\ &amp;
   \texttt{stor\_level\_Δ\_op}[n, first(t_{rp,last})] \times duration(first(t_{rp,last})) + \\ &amp;
   \texttt{stor\_level\_Δ\_rp}[n, t_{rp,last}] \times duration\_strat(t_{rp,last})
\end{aligned}\]</p></li><li><p>The first operational period in subsequent representative periods in any investment period (given by <span>$typeof(t_{prev}) = nothing$</span>) f the the storage behavior is given as <a href="https://energymodelsx.github.io/EnergyModelsBase.jl/stable/library/public/nodes/#EnergyModelsBase.CyclicStrategic"><code>CyclicStrategic</code></a>:<br/></p><p class="math-container">\[\begin{aligned}
 prev\_level = &amp; \texttt{stor\_level}[n, first(t_{rp,prev})] - \\ &amp;
   \texttt{stor\_level\_Δ\_op}[n, first(t_{rp,prev})] \times duration(first(t_{rp,prev})) + \\ &amp;
   \texttt{stor\_level\_Δ\_rp}[n, t_{rp,prev}]
\end{aligned}\]</p><p>This situation only occurs in cases in which the time structure includes representative periods.</p></li><li><p>All other operational periods:<br/></p><p class="math-container">\[ prev\_level = \texttt{stor\_level}[n, t_{prev}]\]</p></li></ol><p>All cases are implemented in <code>EnergyModelsBase</code> simplifying the design of the system.</p><h4 id="nodes-h2_storage-math-con-comp"><a class="docs-heading-anchor" href="#nodes-h2_storage-math-con-comp">Compression constraints</a><a id="nodes-h2_storage-math-con-comp-1"></a><a class="docs-heading-anchor-permalink" href="#nodes-h2_storage-math-con-comp" title="Permalink"></a></h4><p>The storage pressure <span>$p$</span> can be translated into the storage level assuming ideal gas behavior as</p><p class="math-container">\[\texttt{stor\_level}[n, t] = \frac{p-p_{min}}{p_{max}-p_{min}} capacity(level(n), t)\]</p><p>in which <span>$p_{min}$</span> and <span>$p_{max}$</span> corresponds to the minimum and maximum pressure, respectively. The number of compressors <span>$n_{comp}$</span> are calculated as</p><p class="math-container">\[n_{comp} = ceil\left(\frac{\log PR_{tot}}{\log PR_{max}}\right)\]</p><p>in which <span>$PR_{tot} = p_{max}/p_{min}$</span> and <span>$PR_{max}$</span> is a user specified maximum pressure ratio. The utilized pressure ratio is then given as</p><p class="math-container">\[PR = PR_{tot}^{1/n_{comp}}\]</p><p>The required electricity demand for compression is subsequently calculated using the concepts explained on <em><a href="../../aux-fun/pressure_calc/#aux-p_calc">Calculation of compression energy</a></em>.</p><p>The non-linear compression curve is implemented using a piecewise linear approach in which the break points are identified as the inlet to each compressor as well as 1/3 of the pressure ratio in each compressor:</p><p class="math-container">\[\begin{aligned}
  \hat{p}_1 &amp; = p_{min} \\
  \hat{p}_{2i+2} &amp; = p_{in}PR^i &amp; \qquad \text{for} ~ i \in 0, \ldots, n_{comp}-1 \\
  \hat{p}_{2i+3} &amp; = \left(1/3PR+2/3\right)p_{in}PR^i &amp; \qquad \text{for} ~ i \in 0, \ldots, n_{comp}-1 \\
  \hat{p}_{end} &amp; = p_{max} \\
\end{aligned}\]</p><p>Given the formulation, it is possible that some pressures are included twice and that the pressures are not sorted. Hence, the <span>$\hat{\textbef{p}}$</span> is sorted and all duplicates are removed resulting in <span>$n_p$</span> break points.</p><p>The required relative compression energy at each breakpoint <span>$\hat{W}_p$</span> is then calculated using the function <a href="../../library/internals/methods-EMH/#EnergyModelsHydrogen.energy_curve"><code>energy_curve</code></a> as described on <em><a href="../../aux-fun/pressure_calc/#aux-p_calc-train">Compression train</a></em>.</p><p>The implementation through <em><a href="https://jump.dev/JuMP.jl/stable/manual/constraints/#Special-Ordered-Sets-of-Type-2">Special Ordered Sets of Type 2 constraints</a></em> requires the introduction of an auxiliary variable <span>$\lambda \in [0,1]$</span> which is indexed over all operational periods <span>$t \\in T$</span> and all break points given by <span>$1, \ldots, n_p$</span>. The required constraints are subsequently given by</p><p class="math-container">\[\begin{aligned}
\texttt{stor\_level}[n, t] &amp; =
  \sum_{i \in 1, \ldots, n_p} \lambda[t, i]\frac{\hat{p}_i-p_{min}}{p_{max}-p_{min}} capacity(level(n), t) \\
W_p[t] &amp; = \sum_{i \in 1, \ldots, n_p} \lambda[t, i] \hat{W}_p[i]
\end{aligned}\]</p><p>The first constraints link the storage level at each operational period to the pressure <span>$p$</span> through a piecewise linear interpolation utilizing the variables <span>$\lambda[t, :]$</span> and <span>$\hat{\textbf{p}}$</span> while the second constraints calculate the required compression electricity demand <span>$W_p[t]$</span> through a piecewise linear interpolation utilizing the variables <span>$\lambda[t, :]$</span> and <span>$\hat{\textbf{W}}$</span>.</p><p>In addition, we have to declare</p><p class="math-container">\[\begin{aligned}
\sum_{i \in 1, \ldots, n_p} \lambda[t, i] &amp; = 1 \\
\lambda[t, :] &amp; \in SOS2()
\end{aligned}\]</p><p>The first constraint assures a proper linear interpolation between break points while the second constraint states that only 2 of the variables <span>$\lambda[t, :]$</span> can be non-zero. In addition, if two variables are non-zero, they have to be sequential.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../reformer/">« Reformer</a><a class="docs-footer-nextpage" href="../../how-to/contribute/">Contribute to EnergyModelsHydrogen »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Monday 10 February 2025 12:40">Monday 10 February 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
